# KeyHunt-Cuda BUGä¿®å¤å®æ–½è®¡åˆ’

## ğŸš¨ ç«‹å³ä¿®å¤çš„å…³é”®é—®é¢˜

### 1. å†…å­˜æ³„æ¼ä¿®å¤
**æ–‡ä»¶ï¼š** [`KeyHunt.cpp`](keyhuntcuda/KeyHunt-Cuda/KeyHunt.cpp)
**ä¼˜å…ˆçº§ï¼š** ğŸ”´ ä¸¥é‡
**é¢„è®¡æ—¶é—´ï¼š** 2å°æ—¶

```cpp
// å½“å‰é—®é¢˜ä»£ç 
DATA = (uint8_t*)malloc(N * K_LENGTH);
uint8_t* buf = (uint8_t*)malloc(K_LENGTH);

// ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ
auto DATA = std::make_unique<uint8_t[]>(N * K_LENGTH);
auto buf = std::make_unique<uint8_t[]>(K_LENGTH);
```

### 2. ç¼“å†²åŒºæº¢å‡ºé˜²æŠ¤
**æ–‡ä»¶ï¼š** [`Base58.cpp`](keyhuntcuda/KeyHunt-Cuda/Base58.cpp)
**ä¼˜å…ˆçº§ï¼š** ğŸ”´ ä¸¥é‡
**é¢„è®¡æ—¶é—´ï¼š** 1å°æ—¶

```cpp
// å½“å‰é—®é¢˜ä»£ç 
uint8_t digits[256];

// ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨vectorå¹¶æ£€æŸ¥è¾¹ç•Œ
std::vector<uint8_t> digits;
digits.reserve(max_length);
```

### 3. å¹¶å‘å®‰å…¨ä¿®å¤
**æ–‡ä»¶ï¼š** [`KeyHunt.cpp`](keyhuntcuda/KeyHunt-Cuda/KeyHunt.cpp)
**ä¼˜å…ˆçº§ï¼š** ğŸ”´ ä¸¥é‡
**é¢„è®¡æ—¶é—´ï¼š** 3å°æ—¶

```cpp
// ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨RAIIé”
class LockGuard {
private:
#ifdef WIN64
    HANDLE& mutex;
#else
    pthread_mutex_t& mutex;
#endif
public:
    LockGuard(HANDLE& m) : mutex(m) {
#ifdef WIN64
        WaitForSingleObject(mutex, INFINITE);
#else
        pthread_mutex_lock(&mutex);
#endif
    }
    ~LockGuard() {
#ifdef WIN64
        ReleaseMutex(mutex);
#else
        pthread_mutex_unlock(&mutex);
#endif
    }
};
```

## ğŸ› ï¸ æ€§èƒ½ä¼˜åŒ–å®æ–½

### 1. å†…å­˜åˆ†é…ä¼˜åŒ–
**æ–‡ä»¶ï¼š** [`KeyHunt.cpp`](keyhuntcuda/KeyHunt-Cuda/KeyHunt.cpp)
**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ é«˜
**é¢„è®¡æ—¶é—´ï¼š** 4å°æ—¶
**é¢„æœŸæå‡ï¼š** 15-25%

```cpp
// å¯¹è±¡æ± å®ç°
class MemoryPool {
private:
    std::vector<std::unique_ptr<IntGroup>> pool;
    std::queue<IntGroup*> available;
public:
    IntGroup* acquire() {
        if (available.empty()) {
            pool.push_back(std::make_unique<IntGroup>(CPU_GRP_SIZE / 2 + 1));
            return pool.back().get();
        }
        auto* ptr = available.front();
        available.pop();
        return ptr;
    }
    void release(IntGroup* ptr) {
        available.push(ptr);
    }
};
```

### 2. ç®—æ³•ä¼˜åŒ–
**æ–‡ä»¶ï¼š** [`Int.cpp`](keyhuntcuda/KeyHunt-Cuda/Int.cpp)
**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ é«˜
**é¢„è®¡æ—¶é—´ï¼š** 8å°æ—¶
**é¢„æœŸæå‡ï¼š** 20-35%

```cpp
// Karatsubaä¹˜æ³•å®ç°
void Int::MultKaratsuba(Int* a, Int* b) {
    // å®ç°Karatsubaç®—æ³•
    const int threshold = 128; // ä½æ•°é˜ˆå€¼
    if (GetBitLength() < threshold) {
        Mult(a, b); // ä½¿ç”¨æœ´ç´ ä¹˜æ³•
        return;
    }
    // Karatsubaç®—æ³•å®ç°
}
```

### 3. GPUä¼˜åŒ–
**æ–‡ä»¶ï¼š** [`GPU/GPUCompute.h`](keyhuntcuda/KeyHunt-Cuda/GPU/GPUCompute.h)
**ä¼˜å…ˆçº§ï¼š** ğŸŸ¡ é«˜
**é¢„è®¡æ—¶é—´ï¼š** 6å°æ—¶
**é¢„æœŸæå‡ï¼š** 25-45%

```cpp
// å†…å­˜è®¿é—®ä¼˜åŒ–
__device__ __forceinline__ void optimized_memory_access(
    uint64_t* __restrict__ dest,
    const uint64_t* __restrict__ src,
    int size) {
    
    // ä½¿ç”¨å…±äº«å†…å­˜
    extern __shared__ uint64_t shared_mem[];
    
    // åˆå¹¶å†…å­˜è®¿é—®
    int tid = threadIdx.x;
    int global_idx = blockIdx.x * blockDim.x + tid;
    
    // åä½œåŠ è½½åˆ°å…±äº«å†…å­˜
    if (global_idx < size) {
        shared_mem[tid] = src[global_idx];
    }
    __syncthreads();
    
    // å¤„ç†å…±äº«å†…å­˜ä¸­çš„æ•°æ®
    if (global_idx < size) {
        dest[tid] = process_data(shared_mem[tid]);
    }
}
```

## ğŸ“‹ ä¿®å¤æ—¶é—´è¡¨

| ä¼˜å…ˆçº§ | é—®é¢˜ç±»å‹ | é¢„è®¡æ—¶é—´ | è´Ÿè´£äºº | çŠ¶æ€ |
|--------|----------|----------|--------|------|
| ğŸ”´ | å†…å­˜æ³„æ¼ | 2å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸ”´ | ç¼“å†²åŒºæº¢å‡º | 1å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸ”´ | å¹¶å‘å®‰å…¨ | 3å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸ”´ | ç©ºæŒ‡é’ˆæ£€æŸ¥ | 1å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸŸ¡ | å†…å­˜åˆ†é…ä¼˜åŒ– | 4å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸŸ¡ | ç®—æ³•ä¼˜åŒ– | 8å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸŸ¡ | GPUä¼˜åŒ– | 6å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |
| ğŸŸ¢ | æ¶æ„é‡æ„ | 16å°æ—¶ | å¼€å‘å›¢é˜Ÿ | å¾…å¼€å§‹ |

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### 1. å•å…ƒæµ‹è¯•
- å†…å­˜æ³„æ¼æ£€æµ‹ï¼ˆValgrindï¼‰
- ç¼“å†²åŒºæº¢å‡ºæ£€æµ‹ï¼ˆAddressSanitizerï¼‰
- å¹¶å‘æµ‹è¯•ï¼ˆThreadSanitizerï¼‰

### 2. æ€§èƒ½æµ‹è¯•
- åŸºå‡†æ€§èƒ½å¯¹æ¯”
- å†…å­˜ä½¿ç”¨ç›‘æ§
- GPUåˆ©ç”¨ç‡åˆ†æ

### 3. é›†æˆæµ‹è¯•
- å®Œæ•´åŠŸèƒ½æµ‹è¯•
- é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•
- å¤šå¹³å°å…¼å®¹æ€§æµ‹è¯•

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- **å†…å­˜æ³„æ¼ï¼š** 0ä¸ªï¼ˆä½¿ç”¨Valgrindæ£€æµ‹ï¼‰
- **ç¼“å†²åŒºæº¢å‡ºï¼š** 0ä¸ªï¼ˆä½¿ç”¨AddressSanitizeræ£€æµ‹ï¼‰
- **å¹¶å‘é—®é¢˜ï¼š** 0ä¸ªï¼ˆä½¿ç”¨ThreadSanitizeræ£€æµ‹ï¼‰
- **æ€§èƒ½æå‡ï¼š** â‰¥30%
- **ä»£ç é‡å¤ç‡ï¼š** â‰¤20%

### ä¸šåŠ¡æŒ‡æ ‡
- **æœç´¢é€Ÿåº¦æå‡ï¼š** â‰¥30%
- **å†…å­˜ä½¿ç”¨å‡å°‘ï¼š** â‰¥20%
- **ç¨³å®šæ€§æå‡ï¼š** å´©æºƒç‡é™ä½90%

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬1å‘¨ï¼šå…³é”®BUGä¿®å¤
1. ä¿®å¤å†…å­˜æ³„æ¼ï¼ˆç¬¬1-2å¤©ï¼‰
2. ä¿®å¤ç¼“å†²åŒºæº¢å‡ºï¼ˆç¬¬3å¤©ï¼‰
3. ä¿®å¤å¹¶å‘é—®é¢˜ï¼ˆç¬¬4-5å¤©ï¼‰
4. æ·»åŠ é”™è¯¯å¤„ç†ï¼ˆç¬¬6-7å¤©ï¼‰

### ç¬¬2å‘¨ï¼šæ€§èƒ½ä¼˜åŒ–
1. å†…å­˜åˆ†é…ä¼˜åŒ–ï¼ˆç¬¬1-2å¤©ï¼‰
2. ç®—æ³•ä¼˜åŒ–ï¼ˆç¬¬3-5å¤©ï¼‰
3. GPUä¼˜åŒ–ï¼ˆç¬¬6-7å¤©ï¼‰

### ç¬¬3å‘¨ï¼šæµ‹è¯•å’ŒéªŒè¯
1. å•å…ƒæµ‹è¯•ï¼ˆç¬¬1-3å¤©ï¼‰
2. æ€§èƒ½æµ‹è¯•ï¼ˆç¬¬4-5å¤©ï¼‰
3. é›†æˆæµ‹è¯•ï¼ˆç¬¬6-7å¤©ï¼‰

### ç¬¬4å‘¨ï¼šæ–‡æ¡£å’Œéƒ¨ç½²
1. æ›´æ–°æ–‡æ¡£ï¼ˆç¬¬1-2å¤©ï¼‰
2. ä»£ç å®¡æŸ¥ï¼ˆç¬¬3-4å¤©ï¼‰
3. éƒ¨ç½²å‡†å¤‡ï¼ˆç¬¬5-7å¤©ï¼‰

## ğŸ“š æ‰€éœ€èµ„æº

### äººåŠ›èµ„æº
- é«˜çº§C++å¼€å‘å·¥ç¨‹å¸ˆï¼š2äºº
- CUDAå¼€å‘å·¥ç¨‹å¸ˆï¼š1äºº
- æµ‹è¯•å·¥ç¨‹å¸ˆï¼š1äºº

### æŠ€æœ¯èµ„æº
- å¼€å‘ç¯å¢ƒï¼šWSL Ubuntu 20.04
- CUDA Toolkitï¼š11.8
- æµ‹è¯•å·¥å…·ï¼šValgrind, AddressSanitizer, ThreadSanitizer
- æ€§èƒ½åˆ†æå·¥å…·ï¼šNVIDIA Nsight, perf

### æ—¶é—´èµ„æº
- æ€»é¢„è®¡æ—¶é—´ï¼š4å‘¨
- å¼€å‘æ—¶é—´ï¼š3å‘¨
- æµ‹è¯•æ—¶é—´ï¼š1å‘¨

## ğŸ¯ é£é™©è¯„ä¼°

### é«˜é£é™©
- GPUä¼˜åŒ–å¯èƒ½å¼•å…¥æ–°çš„å…¼å®¹æ€§é—®é¢˜
- ç®—æ³•ä¼˜åŒ–å¯èƒ½å½±å“è®¡ç®—ç²¾åº¦

### ä¸­é£é™©
- å†…å­˜ç®¡ç†å˜æ›´å¯èƒ½å½±å“æ€§èƒ½
- å¹¶å‘ä¿®æ”¹å¯èƒ½å¼•å…¥æ­»é”

### ä½é£é™©
- ä»£ç ç»“æ„ä¼˜åŒ–
- æ–‡æ¡£æ›´æ–°

## ğŸ“ æ²Ÿé€šè®¡åˆ’

### æ—¥å¸¸æ²Ÿé€š
- æ¯æ—¥ç«™ä¼šï¼ˆ15åˆ†é’Ÿï¼‰
- é—®é¢˜å³æ—¶æ²Ÿé€šï¼ˆSlack/Teamsï¼‰

### å‘¨æŠ¥
- æ¯å‘¨äº”æäº¤è¿›åº¦æŠ¥å‘Š
- åŒ…å«å®Œæˆåº¦ã€é—®é¢˜ã€ä¸‹å‘¨è®¡åˆ’

### é‡Œç¨‹ç¢‘è¯„å®¡
- ç¬¬1å‘¨æœ«ï¼šBUGä¿®å¤è¯„å®¡
- ç¬¬2å‘¨æœ«ï¼šæ€§èƒ½ä¼˜åŒ–è¯„å®¡
- ç¬¬3å‘¨æœ«ï¼šæµ‹è¯•å®Œæˆè¯„å®¡
- ç¬¬4å‘¨æœ«ï¼šé¡¹ç›®å®Œæˆè¯„å®¡

---
**è®¡åˆ’åˆ¶å®šæ—¶é—´ï¼š** 2025-09-05  
**é¢„è®¡å®Œæˆæ—¶é—´ï¼š** 2025-10-03  
**æ€»æŠ•å…¥ï¼š** 4å‘¨ï¼Œ4äººå›¢é˜Ÿ